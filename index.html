<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pokemon Sleep — Upcoming Events</title>
<style>
:root{
  --bg:#f7fbff; --card:#fff; --muted:#6b7280; --accent:#0ea5e9;
  --track:#e6eef6; --shadow: 0 6px 20px rgba(13, 59, 102, 0.08);
  font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
}
body{margin:0;background:var(--bg);color:#0f172a;}
.wrap{max-width:1100px;margin:28px auto;padding:20px;}
h1{margin:0 0 6px 0;font-size:26px}
p.lead{margin:0;color:var(--muted);font-size:14px;}
.grid{display:grid;gap:18px;margin-top:18px;grid-template-columns:2fr 1fr;}
.card{background:var(--card);border-radius:14px;padding:14px;box-shadow:var(--shadow);border:1px solid rgba(15,23,42,0.04);}
.meta{display:flex;justify-content:space-between;align-items:center;font-size:13px;color:var(--muted);margin-bottom:8px;}
.timeline-viewport{overflow-x:auto;padding:12px;border-radius:10px;border:1px solid #eef2f7;background:linear-gradient(180deg,#fff,#fbfdff);}
.timeline-inner{position:relative;height:120px;min-width:900px;}
.track{position:absolute;left:0;right:0;top:56px;height:6px;background:var(--track);border-radius:6px;}
.event{position:absolute;top:18px;transform:translateX(-50%);min-width:84px;border-radius:10px;padding:8px;border:1px solid rgba(15,23,42,0.04);box-shadow:0 6px 18px rgba(12,74,110,0.05);font-size:12px;color:#fff;text-align:center;}
.marker{position:absolute;top:0;transform:translateX(-50%);text-align:center;pointer-events:none;}
.marker .bar{height:52px;width:2px;background:var(--accent);display:block;margin:0 auto;border-radius:2px;}
.controls{margin-top:12px;padding:6px 2px;}
input[type="range"]{width:100%;}
.events-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin-top:12px;}
.evt-card{background:#fbfdff;border-radius:10px;padding:10px;border:1px solid rgba(15,23,42,0.03);}
.evt-card h4{margin:0;font-size:13px;}
.evt-card p{margin:6px 0 0 0;color:var(--muted);font-size:12px;}
form .row{display:flex;gap:8px;margin-bottom:8px;}
input[type="text"], input[type="date"], textarea, select, input[type="color"]{width:100%;padding:8px;border-radius:8px;border:1px solid #e6eef6;background:#fff;font-size:13px;}
textarea{resize:vertical;}
.btn{cursor:pointer;padding:8px 12px;border-radius:8px;border:0;background:var(--accent);color:white;font-weight:600;}
.btn.ghost{background:transparent;border:1px solid #e6eef6;color:var(--muted);}
.import-area{width:100%;height:110px;padding:8px;border-radius:8px;border:1px solid #eef2f7;background:#fff;resize:vertical;}
footer{margin-top:18px;color:var(--muted);font-size:13px;}
@media(max-width:880px){.grid{grid-template-columns:1fr}.timeline-inner{min-width:700px}}
</style>
</head>
<body>
<div class="wrap">
<header>
<h1>Pokemon Sleep — Upcoming Events</h1>
<p class="lead">Interactive timeline slider. Add events with color and description. JSON import/export supported.</p>
</header>
<div class="grid">
<section class="card">
<div class="meta">
  <div id="rangeLabel">Range: —</div>
  <div id="focusLabel">Focus: —</div>
</div>
<div class="timeline-viewport" id="viewport">
  <div class="timeline-inner" id="timelineInner">
    <div class="track"></div>
    <div id="eventsLayer"></div>
    <div id="marker" class="marker" style="left:0%">
      <span class="bar"></span>
      <div style="margin-top:6px;font-size:12px;color:var(--accent);" id="markerDate">—</div>
    </div>
  </div>
</div>
<div class="controls">
  <input id="scrub" type="range" min="0" max="100" value="0"/>
</div>
<div class="events-grid" id="eventsList"></div>
</section>
<aside class="card">
<h3>Add Event</h3>
<form id="addForm">
  <input type="text" id="title" placeholder="Title (required)" required/>
  <div class="row">
    <input type="date" id="start" required/>
    <input type="date" id="end"/>
  </div>
  <textarea id="desc" rows="3" placeholder="Short description (optional)"></textarea>
  <label>Event Color:</label>
  <input type="color" id="color" value="#ff0000"/>
  <div style="display:flex;gap:8px;margin-top:8px;">
    <button class="btn" type="submit">Add</button>
    <button id="clearAll" class="btn ghost" type="button">Clear All</button>
  </div>
</form>
<hr style="margin:12px 0"/>
<h4>Import JSON</h4>
<textarea id="importArea" class="import-area" placeholder='Paste JSON array of events'></textarea>
<div style="display:flex;gap:8px;margin-top:8px;">
  <button id="importBtn" class="btn">Import</button>
  <button id="exportBtn" class="btn ghost">Copy JSON</button>
</div>
</aside>
</div>
<footer>Built for GitHub Pages — events stored locally or via events.json.</footer>
</div>

<script>
// ✅ Global events array
window.events = [];

// Functions
const eventsLayer=document.getElementById('eventsLayer');
const eventsList=document.getElementById('eventsList');
const scrub=document.getElementById('scrub');
const marker=document.getElementById('marker');
const markerDate=document.getElementById('markerDate');
const rangeLabel=document.getElementById('rangeLabel');
const focusLabel=document.getElementById('focusLabel');
const timelineInner=document.getElementById('timelineInner');
const viewport=document.getElementById('viewport');

const STORAGE_KEY='pokemon_sleep_events_v1';

function saveEvents(){localStorage.setItem(STORAGE_KEY,JSON.stringify(window.events));}
function parseDate(d){return d instanceof Date?d:new Date(d+'T00:00:00');}
function fmtDate(d){return parseDate(d).toLocaleDateString();}

let minDate,maxDate;
function computeRange(){
  if(window.events.length===0){const t=new Date();minDate=new Date(t);maxDate=new Date(t);return;}
  const starts=window.events.map(e=>parseDate(e.start).getTime());
  const ends=window.events.map(e=>parseDate(e.end||e.start).getTime());
  const min=new Date(Math.min(...starts));min.setDate(min.getDate()-4);
  const max=new Date(Math.max(...ends));max.setDate(max.getDate()+4);
  minDate=min;maxDate=max;
}

function dateToPct(date){const d=parseDate(date).getTime();const total=maxDate.getTime()-minDate.getTime();return total===0?0:((d-minDate.getTime())/total)*100;}
function setMarkerFromPct(pct){
  const bounded=Math.max(0,Math.min(100,pct));
  marker.style.left=bounded+'%';
  const ms=minDate.getTime()+(bounded/100)*(maxDate.getTime()-minDate.getTime());
  const dt=new Date(ms);
  markerDate.textContent=dt.toLocaleDateString();
  focusLabel.textContent='Focus: '+dt.toLocaleDateString();
  viewport.scrollTo({left:(bounded/100)*(timelineInner.scrollWidth-viewport.clientWidth),behavior:'smooth'});
}

// Load events from events.json or localStorage
(async function(){
  try{
    const res = await fetch('events.json');
    if(res.ok){
      const arr = await res.json();
      window.events = arr.map(e=>({id:e.id,title:e.title,start:e.start,end:e.end?e.end:e.start,description:e.description||'',color:e.color||'#3b82f6'}));
      saveEvents();
    } else {throw new Error('No events.json');}
  } catch(e){
    const saved = localStorage.getItem(STORAGE_KEY);
    if(saved) window.events = JSON.parse(saved);
  }
  renderTimeline();
})();

// Render timeline
function renderTimeline(){
  computeRange();
  rangeLabel.textContent='Range: '+(minDate?minDate.toLocaleDateString():'—')+' — '+(maxDate?maxDate.toLocaleDateString():'—');
  eventsLayer.innerHTML='';eventsList.innerHTML='';
  const sorted = window.events.slice().sort((a,b)=>parseDate(a.start)-parseDate(b.start));
  sorted.forEach(ev=>{
    const left=dateToPct(ev.start);
    const right=dateToPct(ev.end||ev.start);
    const widthPct=Math.max(1,right-left);
    const el=document.createElement('div');
    el.className='event';
    el.style.left=left+'%';
    el.style.width=widthPct+'%';
    el.style.backgroundColor=ev.color||'#3b82f6';
    el.innerHTML='<div>'+ev.title+'</div><div style="font-size:11px">'+ev.start+(ev.end&&ev.end!==ev.start?' — '+ev.end:'')+'</div>';
    eventsLayer.appendChild(el);

    const card=document.createElement('div');
    card.className='evt-card';
    card.innerHTML='<h4 style="color:'+ (ev.color||'#0ea5e9') +'">'+ev.title+'</h4><p>'+ev.start+(ev.end&&ev.end!==ev.start?' — '+ev.end:'')+'</p><p style="color:#6b7280">'+(ev.description||'No description')+'</p>';
    card.addEventListener('click',()=>{scrub.value=dateToPct(ev.start);setMarkerFromPct(scrub.value);});
    eventsList.appendChild(card);
  });
  scrub.dispatchEvent(new Event('input'));
}

// Add event form
document.getElementById('addForm').addEventListener('submit',e=>{
  e.preventDefault();
  const title=document.getElementById('title').value;
  const start=document.getElementById('start').value;
  const end=document.getElementById('end').value;
  const desc=document.getElementById('desc').value;
  const color=document.getElementById('color').value;
  if(!title||!start){alert('Title & start date required');return;}
  window.events.push({id:Date.now().toString(),title,start,end:end?end:start,description:desc,color});
  saveEvents();
  document.getElementById('addForm').reset();
  renderTimeline();
});

// Clear all events
document.getElementById('clearAll').addEventListener('click',()=>{
  if(confirm('Clear all events?')){
    window.events=[];
    saveEvents();
    renderTimeline();
  }
});

// Import JSON
document.getElementById('importBtn').addEventListener('click',()=>{
  try{
    const arr=JSON.parse(document.getElementById('importArea').value.trim());
    if(!Array.isArray(arr)) throw new Error('JSON should be array');
    arr.forEach((o,i)=>{if(!o.start) throw new Error('Event missing start at '+i);o.id=o.id||('imp'+i);o.color=o.color||'#3b82f6';o.end=o.end?o.end:o.start;o.description=o.description||'';});
    window.events=window.events.concat(arr);
    saveEvents();
    renderTimeline();
    document.getElementById('importArea').value='';
    alert('Imported '+arr.length+' events.');
  }catch(err){alert('Invalid JSON: '+err.message);}
});

// Export JSON
document.getElementById('exportBtn').addEventListener('click',()=>{
  navigator.clipboard.writeText(JSON.stringify(window.events,null,2)).then(()=>alert('Copied JSON to clipboard'));
});

// Scrubber
scrub.addEventListener('input',e=>{setMarkerFromPct(Number(e.target.value));});

</script>
</body>
</html>
